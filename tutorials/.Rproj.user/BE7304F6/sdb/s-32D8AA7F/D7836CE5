{
    "contents" : "#Step 1: Instal DESeq2 and Load Package\nsource(\"http://bioconductor.org/biocLite.R\")\nbiocLite(\"DESeq2\")\nbrowseVignettes(\"DESeq2\")\nlibrary(DESeq2)\n\n#Step 2: Read in data for tutorial\ndata <- read.table(\"Phel_countdata.txt\", header = T, sep = \"\\t\")\nrownames(data) <- data$Feature\ndata <- data[,-1]\n\n#Step 3: Build objects, specify which columns are in which group\ndeseq2.colData <- data.frame(condition=factor(c(rep(\"Treated\", 3), rep(\"Control\", 3))), type=factor(rep(\"single-read\", 6)))\nrownames(deseq2.colData) <- colnames(data)\ndeseq2.dds <- DESeqDataSetFromMatrix(countData = data, colData = deseq2.colData, design = ~ condition)\n\n#Step 4: Run analysis and confirm results\ndeseq2.dds <- DESeq(deseq2.dds)\ndeseq2.res <- results(deseq2.dds)\ndeseq2.res <- deseq2.res[order(rownames(deseq2.res)), ]\nhead(deseq2.res)\n\n#Step 5: Count number of hits with adjusted p-value less than 0.05\ndim(deseq2.res[!is.na(deseq2.res$padj) & deseq2.res$padj <= 0.05, ])\n\n#Step 6: Create plot\ntmp <- deseq2.res\n#The main plot\nplot(tmp$baseMean, tmp$log2FoldChange, pch=20, cex=0.45, ylim=c(-3, 3), log=\"x\", col=\"darkgray\", main=\"DEG Virus Exposure  (pval <= 0.05)\", xlab=\"mean of normalized counts\", ylab=\"Log2 Fold Change\")\n#Getting the significant points and plotting them again so they're a different color\ntmp.sig <- deseq2.res[!is.na(deseq2.res$padj) & deseq2.res$padj <= 0.05, ]\npoints(tmp.sig$baseMean, tmp.sig$log2FoldChange, pch=20, cex=0.45, col=\"violetred\")\n# 2 FC lines\nabline(h=c(-1,1), col=\"blue\")\n\n#Step 7: Create table with differentially expressed contigs\nwrite.table(tmp.sig, \"Phel_DEGlist.tab\", row.names = T)\n\n### NOTE: Before Step 8, I uploaded the Phel_transcriptome.fasta file and converted it into a .tab file using Galaxy ###\n\n#Step 8: Merge two datatables modified from Galaxy\nfull_transcriptome <- read.table(\"Galaxy8-[Phel_transcriptome.tab].tabular\") #tab file of full seastar transcriptome\ndiffexpressedgenes <- read.table(\"Phel_DEGlist.tab\") #tab file of differentially expressed genes in seastars with wasting disease\n\ncolnames(full_transcriptome) <- c(\"contig\", \"sequence\") #add column names to full_transcriptome\nhead(full_transcriptome) #confirm addition of column names\n\ninstall.packages(\"data.table\")\nlibrary(data.table)\nsetDT(diffexpressedgenes, keep.rownames = TRUE) #convert row names to a separate column in diffexpressedgenes\ncolnames(diffexpressedgenes) <- c(\"contig\", \"baseMean\", \"log2FoldChange\", \"lfcSE\", \"stat\", \"pvalue\", \"padj\")\nhead(diffexpressedgenes) #confirm addition of column names\n\nPhel_diffexpressed_transcriptome <- merge(x = diffexpressedgenes, y = full_transcriptome, by = \"contig\") #merge two dataframes together\n\n#Step 9: Remove all columns that are not \"contig\" and \"sequence\" (ie. remove \"baseMean\", \"log2FoldChange\", \"lfcSE\", \"stat\", \"pvalue\", \"padj\")\n\nPhel_diffexpressed_transcriptome$baseMean <- NULL\nPhel_diffexpressed_transcriptome$log2FoldChange <- NULL\nPhel_diffexpressed_transcriptome$lfcSE <- NULL\nPhel_diffexpressed_transcriptome$stat <- NULL\nPhel_diffexpressed_transcriptome$pvalue <- NULL\nPhel_diffexpressed_transcriptome$padj <- NULL\nhead(Phel_diffexpressed_transcriptome) #confirm column removal\n\n#Step 10: Write out Phel_diffexpressed_transcritpome as a tab file\nwrite.table(Phel_diffexpressed_transcriptome, \"Phel_diffexpressed_transcriptome.tab\", col.names = T)\n\n### NOTE: The Phel_diffexpressed_transcriptome.tab file will be converted into a fasta file so I can use it as a database in BLAST ###\n",
    "created" : 1477600596840.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1421750903",
    "id" : "D7836CE5",
    "lastKnownWriteTime" : 1477604900,
    "path" : "~/Documents/School/Year1/FISH-546/yaaminiv-fish546-2016/tutorials/2016-10-26-DESeq2-Tutorial.R",
    "project_path" : "2016-10-26-DESeq2-Tutorial.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}